# 迭代1 - PRD

> 核心流程可用

---

## 一、迭代目标

**让核心流程跑通**：引入最基础的脚本 (npm scripts) 配合 AI 执行，降低纯手动操作的繁琐度，确保流程可落地。

---

## 二、功能范围

### 2.1 输入日志机制

**目的**：捕获人类所有关键输入，不丢失决策依据

**功能**：
- AI 判断输入是否为"关键输入"
- 关键输入记录到 `.flow/input-log.md`
- 记录格式：时间、原文、类型、阶段、归纳

**验收标准**：
- [ ] 人类的需求/决策/反馈/变更都被记录
- [ ] 可追溯任何决策的原始依据

### 2.2 灵光收集箱

**目的**：捕获灵光一闪，不打断当前流程

**功能**：
- AI 识别"灵光"（与当前任务无关的想法）
- 记录到 `.flow/spark-box.md`
- 告知人类已记录，继续当前任务
- 阶段结束时回顾待处理灵光

**验收标准**：
- [ ] 灵光不打断当前任务
- [ ] 灵光不丢失
- [ ] 有机制处理待处理灵光

### 2.3 流程上下文

**目的**：AI 始终知道当前阶段，主动引导

**功能**：
- AI 维护当前阶段、当前任务
- 人类输入与阶段不符时，AI 主动引导
- 提供切换选项：立即处理 or 记录灵光

**验收标准**：
- [ ] AI 能说出"当前在XX阶段"
- [ ] AI 不直接响应字面需求，先判断是否符合阶段
- [ ] 提供明确的引导和选项

### 2.4 状态管理

**目的**：人类可读 + AI 可用

**功能**：
- 唯一数据源：`.flow/state.json`
- IDE 中节点可折叠，结构清晰，人类和 AI 都可读写
- 迭代1 不引入 status.md，避免双文件同步负担

**验收标准**：
- [ ] 人类在 IDE 中查看 state.json 能快速了解全局（节点折叠）
- [ ] AI 能读写 state.json 获取和更新状态
- [ ] 提供 `npm run status` 格式化输出 state.json 关键信息
- [ ] 提供 `npm run log` 快速记录输入

### 2.5 上下文加载脚本

**目的**：一键输出当前上下文，避免每次手动告诉AI"我在哪、我要做什么"

**功能**：
- `npm run context` 一键输出当前上下文到剪贴板
- 输出内容：status.md + 当前迭代PRD + 当前关注的模块文档（如有）
- 人类粘贴给AI即可恢复上下文

**验收标准**：
- [ ] 运行 `npm run context` 能输出格式化的上下文
- [ ] 输出内容包含当前状态和相关文档
- [ ] 新会话时粘贴上下文，AI能理解当前进度

---

## 三、不包含（迭代2+）

- 复杂的 IDE 插件
- 全自动化的 CI/CD 流水线

---

## 四、依赖

无外部依赖，纯流程规范 + 手动执行

---

## 五、验收标准（整体）

### 可执行验收清单

| 验收项 | 验证方法 | 通过标准 |
|--------|----------|----------|
| 自举验证 | 用此流程完成迭代1开发 | 迭代1功能全部实现 |
| 输入日志 | 检查 `.flow/input-log.md` | 包含本迭代的关键决策记录 |
| 灵光收集 | 检查 `.flow/spark-box.md` | 灵光有记录，阶段结束时有处理 |
| 流程引导 | 人工测试：在规划阶段要求写代码 | AI 识别并引导，不直接执行 |
| 状态可读 | IDE 打开 `.flow/state.json` | 节点可折叠，结构清晰 |
| 上下文恢复 | 运行 `npm run context`，新会话粘贴 | AI 能理解当前状态并继续工作 |

### AI 可执行测试

```bash
# 状态查看
npm run status
# 预期：输出当前阶段、进度概览

# 上下文输出
npm run context
# 预期：输出 status.md + 当前迭代PRD 的拼接内容

# 输入记录
npm run log "这是一条测试输入"
# 预期：追加到 input-log.md
```

---

*版本：v0.4*
*更新时间：2024-12-17*
*更新内容：v0.3 增加上下文加载脚本、验收标准可执行化；v0.4 简化状态管理为仅 state.json*

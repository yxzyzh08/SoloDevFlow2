# Write Commands Review Report

> Generated by Review Assistant | 2025-12-28

---

## 1. Executive Summary

本次评审覆盖 `template/commands/` 目录下的 7 个命令文件，对照需求文档 `fea-write-commands.md` 和行业最佳实践进行分析。

| 属性 | 值 |
|------|-----|
| 评审对象 | 7 个 Write Commands |
| 需求文档 | `docs/requirements/features/fea-write-commands.md` v2.2 |
| 总体评估 | **NEEDS_REVISION** |
| Critical Issues | 2 |
| Recommendations | 8 |

---

## 2. Commands Overview (7 个命令的共同特征)

### 2.1 共同优点

1. **结构统一**：所有命令采用相同的文档结构（参数 / 执行步骤 / 输出要求 / 注意事项）
2. **Frontmatter 规范**：均包含 `description` 字段（符合 Claude Code 规范）
3. **规范引用**：正确使用 `@` 语法加载规范文件
4. **新建/更新模式**：均说明了两种模式的触发条件和行为差异
5. **双语约定**：遵循项目双语规范（英文标题、中文描述）

### 2.2 共同问题

1. **缺少 `allowed-tools` 字段**：未限制命令可使用的工具
2. **缺少 `argument-hint` 字段**：带参数的命令未提供参数提示
3. **异常处理描述不足**：未明确说明参数缺失时的行为

---

## 3. Individual Command Review

### 3.1 write-prd.md

**优点**：
- 无参数设计，简洁明了
- 必选/可选章节分离清晰
- 输出路径固定，符合需求

**问题**：
- [P2] 缺少对 `id` 和 `status` 可选字段的说明（需求文档 2.1 推荐填写）

**需求符合度**：Pass

---

### 3.2 write-feature.md

**优点**：
- 正确使用 `$1`、`$2` 参数格式
- Domain 参数可选，设计合理
- 包含 Feature Types（code/document）说明

**问题**：
- [P1] 缺少 `argument-hint` 提示参数用法
- [P2] 未说明 `$1` 缺失时的提示行为（需求 4.2 异常场景要求）
- [P2] 锚点表格中 `{name}` 未说明来自 `$1`

**需求符合度**：Partial (缺少异常处理说明)

---

### 3.3 write-capability.md

**优点**：
- 参数说明清晰
- Consumers 表格格式说明完善
- 创建条件说明有助于决策

**问题**：
- [P1] 缺少 `argument-hint`
- [P2] workMode 固定为 `code`，但未解释原因

**需求符合度**：Pass

---

### 3.4 write-flow.md

**优点**：
- 参数和输出路径正确
- Participants 章节说明完善
- 流程图格式建议（ASCII/Mermaid）实用

**问题**：
- [P1] 缺少 `argument-hint`
- [P3] Frontmatter 示例中 `id: {$1}-flow` 与需求文档不一致（需求文档为 `{$1}-flow`，但锚点前缀为 `flow_{name}_`，存在命名风格不统一）

**需求符合度**：Pass

---

### 3.5 write-design.md

**优点**：
- `inputs` 字段示例清晰
- 必选/可选章节分类完整
- 设计与需求多对多关系提示有用

**问题**：
- [P0] **加载规范错误**：命令写的是 `@docs/specs/spec-design.md（S4 Design Structure）`，但实际应加载完整规范，不仅是第 4 节
- [P1] 缺少 `argument-hint`
- [P2] 未提及 Design Depth 判断流程（spec-design.md 第 3 节）

**需求符合度**：Partial (规范引用不完整)

---

### 3.6 write-req-spec.md

**优点**：
- 无参数设计，简洁
- 加载 `spec-meta.md` 作为元规范正确
- 影响分析命令提示实用

**问题**：
- [P0] **缺少核心输出要求**：未列出 Frontmatter 字段要求（规范文档应有 type/version）
- [P2] 核心章节表格未说明锚点格式

**需求符合度**：Partial (Frontmatter 说明缺失)

---

### 3.7 write-design-spec.md

**优点**：
- 与 write-req-spec.md 结构一致
- 加载 `spec-meta.md` 正确
- 影响分析命令提示

**问题**：
- [P0] **缺少核心输出要求**：未列出 Frontmatter 字段要求
- [P2] 核心章节表格不完整（缺少 Frontmatter 章节）

**需求符合度**：Partial (Frontmatter 说明缺失)

---

## 4. Consistency Analysis

| 维度 | write-prd | write-feature | write-capability | write-flow | write-design | write-req-spec | write-design-spec |
|------|:---------:|:-------------:|:----------------:|:----------:|:------------:|:--------------:|:-----------------:|
| description | OK | OK | OK | OK | OK | OK | OK |
| allowed-tools | -- | -- | -- | -- | -- | -- | -- |
| argument-hint | N/A | -- | -- | -- | -- | N/A | N/A |
| 参数格式 ($1/$2) | N/A | OK | OK | OK | OK | N/A | N/A |
| @ 规范引用 | OK | OK | OK | OK | OK | OK | OK |
| 新建/更新模式 | OK | OK | OK | OK | OK | OK | OK |
| Frontmatter 示例 | OK | OK | OK | OK | OK | -- | -- |
| 锚点格式说明 | OK | OK | OK | OK | OK | Partial | Partial |
| 异常处理说明 | N/A | -- | -- | -- | -- | N/A | N/A |

**图例**：OK = 符合 | -- = 缺失 | Partial = 部分符合 | N/A = 不适用

---

## 5. Requirements Compliance Matrix

对照需求文档 `fea-write-commands.md` 的验收条件：

| AC Item | Command | Status | Notes |
|---------|---------|--------|-------|
| 4.1 PRD 命令 | write-prd | PASS | 符合 spec-requirements.md S3 结构 |
| 4.1 Feature 命令 | write-feature | PASS | 包含 Intent/Core Functions/Acceptance Criteria |
| 4.1 Feature 多参数 | write-feature | PASS | 正确解析 $1=name, $2=domain |
| 4.1 Capability 命令 | write-capability | PASS | 包含 Intent/Consumers/Requirements |
| 4.1 Flow 命令 | write-flow | PASS | 包含 Overview/Steps/Participants |
| 4.1 Design 命令 | write-design | PASS | 包含 inputs/Overview/Technical Approach |
| 4.1 规范加载 | All | PARTIAL | 部分命令规范引用不够完整 |
| 4.1 锚点生成 | All | PASS | 格式正确 |
| 4.1 更新模式 | All | PASS | 保留未变更章节 |
| 4.2 缺少必填参数 | write-feature/capability/flow/design | FAIL | 未说明提示行为 |
| 4.2 规范文件缺失 | All | FAIL | 未说明终止执行行为 |
| 4.2 目标目录不存在 | All | FAIL | 未说明处理方式 |

---

## 6. Best Practices Alignment

### 6.1 Claude Code Custom Commands Best Practices

| Best Practice | Current Status | Recommendation |
|--------------|----------------|----------------|
| Frontmatter `description` | OK | - |
| Frontmatter `allowed-tools` | Missing | 添加以限制工具使用范围 |
| Frontmatter `argument-hint` | Missing | 添加参数提示（如 `[name] [domain?]`） |
| Frontmatter `model` | Not needed | 可选，当前使用默认模型即可 |
| Clear step-by-step instructions | OK | - |
| Context efficiency | OK | 使用 @ 语法按需加载规范 |

**Sources**: [Slash commands - Claude Code Docs](https://code.claude.com/docs/en/slash-commands)

### 6.2 Anthropic Prompt Engineering Best Practices

| Best Practice | Current Status | Recommendation |
|--------------|----------------|----------------|
| Clear, explicit instructions | Good | 步骤描述清晰 |
| Examples aligned with behaviors | Partial | Frontmatter 示例完整，但缺少输出示例 |
| Allow "I don't know" | Missing | 应说明规范缺失时的处理 |
| Breaking down complex tasks | OK | 步骤分解合理 |
| Output formatting instructions | OK | 表格格式明确 |

**Sources**: [Prompting best practices - Claude Docs](https://docs.claude.com/en/docs/build-with-claude/prompt-engineering/claude-4-best-practices), [Claude Code: Best practices for agentic coding](https://www.anthropic.com/engineering/claude-code-best-practices)

---

## 7. Findings

### 7.1 Critical Issues (P0)

| ID | Issue | Affected Commands | Recommendation |
|----|-------|-------------------|----------------|
| P0-1 | 规范类命令（write-req-spec, write-design-spec）缺少 Frontmatter 输出要求 | write-req-spec, write-design-spec | 添加 Frontmatter 字段定义（type, version 等） |
| P0-2 | write-design 规范引用不完整，未提及 Design Depth 判断 | write-design | 加载完整 spec-design.md，提及第 3 节判断流程 |

### 7.2 Major Issues (P1)

| ID | Issue | Affected Commands | Recommendation |
|----|-------|-------------------|----------------|
| P1-1 | 缺少 `argument-hint` Frontmatter 字段 | write-feature, write-capability, write-flow, write-design | 添加参数提示（如 `argument-hint: [name] [domain?]`） |
| P1-2 | 缺少 `allowed-tools` Frontmatter 字段 | All | 添加工具限制（如 `allowed-tools: Read, Write, Glob`） |
| P1-3 | 异常场景处理未说明 | All with parameters | 添加参数缺失时的提示逻辑说明 |

### 7.3 Minor Issues (P2)

| ID | Issue | Affected Commands | Recommendation |
|----|-------|-------------------|----------------|
| P2-1 | 未说明 `id`/`status` 可选字段推荐填写 | write-prd | 在 Frontmatter 示例中添加推荐字段 |
| P2-2 | 锚点表格中 `{name}` 来源未说明 | write-feature | 添加注释说明 `{name}` 来自 `$1` |
| P2-3 | write-capability 的 workMode 固定为 code 未解释 | write-capability | 添加说明（Capability 通常是代码实现） |
| P2-4 | write-flow 的 id 命名风格不一致 | write-flow | 统一为 `{$1}-flow` 或 `{$1}` |

### 7.4 Suggestions (P3)

| ID | Issue | Affected Commands | Recommendation |
|----|-------|-------------------|----------------|
| P3-1 | 可添加输出示例 | All | 添加完整的输出文档示例（可折叠） |
| P3-2 | 可添加常见错误提示 | All | 添加 FAQ 或常见问题处理 |

---

## 8. Improvement Recommendations

### 8.1 Frontmatter Enhancement (All Commands)

```yaml
---
description: 编写或更新 Feature Spec 文档
allowed-tools: Read, Write, Glob
argument-hint: [name] [domain?]
---
```

### 8.2 Add Exception Handling Section

```markdown
## 异常处理

- **参数缺失**：提示用户提供必填参数，不执行后续步骤
- **规范文件缺失**：提示 "规范文件 {path} 不存在，请检查项目初始化是否完成"
- **目标目录不存在**：自动创建目录，或提示用户
```

### 8.3 Enhance write-design.md

```markdown
## 执行步骤

1. 加载规范文档：@docs/specs/spec-design.md
2. 确定输出路径：`docs/designs/des-{$1}.md`
3. 检查目标文件是否存在
   - 不存在 -> 新建模式
   - 存在 -> 更新模式（保留未变更章节）
4. **评估 Design Depth**（参见规范 S3）：
   - 判断是否需要设计文档
   - 如需要，继续编写；否则提示用户
5. 确认输入需求（inputs 字段）
6. 根据用户输入编写/更新文档
7. 输出文件
```

### 8.4 Enhance write-req-spec.md / write-design-spec.md

```markdown
## 输出要求

**Frontmatter**：

\`\`\`yaml
---
# 规范文档无需 type 字段（隐含为 spec）
# 使用标题中的 id 锚点标识
---
\`\`\`

**锚点格式**：`spec_req_{section}` / `spec_design_{section}`
```

---

## 9. Scoring

| 维度 | 权重 | 得分 | 说明 |
|------|------|------|------|
| 完整性 | 25% | 75/100 | 缺少异常处理、Frontmatter 扩展字段 |
| 一致性 | 20% | 90/100 | 7 个命令结构高度一致 |
| 清晰度 | 20% | 85/100 | 步骤清晰，但锚点来源说明不足 |
| 需求符合度 | 25% | 80/100 | 正常场景符合，异常场景缺失 |
| 最佳实践 | 10% | 70/100 | 缺少 allowed-tools、argument-hint |

**加权总分：80/100**

---

## 10. Conclusion

### 10.1 Overall Assessment: **NEEDS_REVISION**

7 个 Write Commands 整体质量良好，结构统一、规范引用正确、双语约定遵守。但存在以下需要修订的问题：

1. **P0 Critical**：规范类命令缺少 Frontmatter 输出要求；write-design 未完整引用 Design Depth 判断
2. **P1 Major**：所有命令缺少 `allowed-tools` 和 `argument-hint` Frontmatter 字段；异常场景处理说明缺失

### 10.2 Next Steps

1. **立即修复** (P0)：
   - 完善 `write-req-spec.md` 和 `write-design-spec.md` 的 Frontmatter 输出要求
   - 增强 `write-design.md` 的 Design Depth 判断引用

2. **短期改进** (P1)：
   - 为所有命令添加 `allowed-tools` Frontmatter
   - 为带参数命令添加 `argument-hint` Frontmatter
   - 添加异常处理章节

3. **持续优化** (P2/P3)：
   - 统一命名风格
   - 添加输出示例

---

## Sources

- [Slash commands - Claude Code Docs](https://code.claude.com/docs/en/slash-commands)
- [Prompting best practices - Claude Docs](https://docs.claude.com/en/docs/build-with-claude/prompt-engineering/claude-4-best-practices)
- [Claude Code: Best practices for agentic coding](https://www.anthropic.com/engineering/claude-code-best-practices)
- [How to Create Custom Slash Commands in Claude Code](https://en.bioerrorlog.work/entry/claude-code-custom-slash-command)
- [Claude Code customization guide](https://alexop.dev/posts/claude-code-customization-guide-claudemd-skills-subagents/)

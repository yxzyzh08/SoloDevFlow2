# SoloDevFlow 2.0 - AI 超级个体开发规范

> 1人 + Claude Code 的软件产品研发全流程规范

---

## 一、核心理念

### 这是什么

一套**人机协作开发规范**，让1个人借助 Claude Code 完成软件产品的全流程研发。

### 核心原则

| 原则 | 说明 |
|------|------|
| **人主导决策** | 人类负责需求、方向、验收；AI 负责执行、生成 |
| **流程保证质量** | 不是靠 AI 自觉，而是靠流程 + 工具强制 |
| **捕获 > 遗忘** | 人类的每个输入都被捕获，不丢失 |
| **先全局后细节** | 任何输出都是总分结构，先给结论 |

---

## 二、解决的核心问题

| 问题 | 解决机制 |
|------|----------|
| 人类注意力分散，灵光一闪会打断当前任务 | **灵光收集箱**：记录灵光，不打断流程 |
| AI 不按流程执行，直接响应字面需求 | **流程上下文**：AI 始终知道当前阶段 |
| 变更影响感知差，只改局部不顾全局 | **影响分析**：变更前先分析影响范围 |
| 文档规范不执行，靠 AI 自觉不可靠 | **工具校验**：关键节点强制校验 |
| 状态信息过载，人类无法阅读 | **分层状态**：摘要层（人看）+ 详情层（AI用） |
| AI 输出过载，结构混乱 | **输出规范**：强制总分结构 |
| 人类输入没有保存，决策依据丢失 | **输入日志**：捕获所有关键输入 |

---

## 三、流程全景

```
┌─────────────────────────────────────────────────────────────────┐
│                         项目生命周期                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   【项目启动】(一次性)                                            │
│     产品PRD + 流程文档                                           │
│     ↓                                                           │
│   【迭代 1】                                                      │
│     需求 ←→ 设计 ←→ 实现 → 验证                                   │
│     ↓        (可回退)                                            │
│   【迭代 2】(迭代1完成后才开始)                                    │
│     需求 ←→ 设计 ←→ 实现 → 验证                                   │
│     ↓                                                           │
│   【迭代 N】...                                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 阶段说明

| 阶段 | 核心活动 | 产出 | 审批 |
|------|----------|------|------|
| **项目启动** | 定义愿景、元原则、路线图 | 产品PRD、流程文档 | 人类审批 |
| **迭代-需求** | 分析需求、定义范围、明确验收标准 | 迭代PRD | 人类审批 |
| **迭代-设计** | 模块拆分、接口定义、技术方案 | 模块文档（可选） | 人类审批 |
| **迭代-实现** | 编码、单元测试 | 代码 | 自动验证 |
| **迭代-验证** | 集成测试、验收测试 | 测试报告 | 人类验收 |

### 回退规则

**阶段可回退**：发现问题时可回退到早期阶段

| 当前阶段 | 回退到 | 触发条件 |
|----------|--------|----------|
| 设计 | 需求 | 需求不完整/矛盾 |
| 实现 | 设计 | 设计不可行 |
| 实现 | 需求 | 需求理解偏差 |
| 验证 | 设计 | 发现设计缺陷 |
| 验证 | 需求 | 需求定义错误 |

**回退时必须**：
1. 记录回退原因到输入日志
2. 更新受影响模块的状态
3. 标记待重做的产出物

---

## 四、核心机制

### 4.1 输入日志（Input Log）

**目的**：捕获人类所有关键输入，不丢失决策依据

**判断规则**：
```
每次人类输入后，AI 判断：
  这是"关键输入"吗？（需求、决策、反馈、变更）
    ├─ 是 → 记录到输入日志
    └─ 否 → 不记录（闲聊、确认等）
```

**AI操作**：读取 `.flow/input-log.md`，按现有格式在表格末尾追加新行

### 4.2 灵光收集箱（Spark Box）

**目的**：捕获灵光一闪，不打断当前流程

**AI行为**：
```
场景：正在做任务A，人类突然提到任务B

  1. 识别这是"灵光"（与当前任务无关的想法）
  2. 记录到灵光收集箱
  3. 告知人类："已记录到灵光收集箱，我们继续任务A"
  4. 继续当前任务

处理时机：当前任务完成后 / 人类主动说"处理灵光" / 阶段切换时回顾
```

**AI操作**：读取 `.flow/spark-box.md`，在"待处理"下追加新条目；处理后移到"已处理"

### 4.3 流程上下文（Flow Context）

**目的**：AI 始终知道当前阶段，主动引导而非被动响应

```
AI 始终维护：
  - 当前阶段：项目启动 / 迭代X-需求 / 迭代X-设计 / ...
  - 当前任务：具体在做什么
  - 待处理灵光：有多少未处理

人类用自然语言时，AI 行为：
  1. 理解人类意图
  2. 判断是否符合当前阶段
     ├─ 符合 → 执行
     └─ 不符合 → 引导
        "你说的是调整需求，按流程应该先更新PRD，要现在切换吗？"
```

### 4.4 影响分析（Impact Analysis）

**目的**：变更前先分析影响，不遗漏关联

```
触发条件：任何需求/设计变更

AI 行为：
  1. 暂停执行
  2. 分析影响范围
     - 直接影响：哪些文档/代码需要改
     - 间接影响：哪些关联模块受影响
  3. 输出影响报告（总分结构）
  4. 人类确认后再执行

影响报告格式：
  【变更】：xxx
  【直接影响】：
    - 文档A：需要更新xxx
    - 代码B：需要修改xxx
  【间接影响】：
    - 模块C：因为依赖A，需要检查xxx
  【建议操作顺序】：1→2→3
```

### 4.5 状态管理（State Management）

**目的**：人类可读 + AI 可用 + 跨 Session 连续

```
【迭代1】唯一数据源：state.json
  - 在 IDE 中节点可折叠，结构清晰
  - AI 每次对话开始时主动读取恢复状态
  - 不引入 status.md，避免双文件同步负担

【迭代2+】可选增加 status.md
  - state.json 保持为唯一数据源
  - 脚本自动生成 status.md 供快速浏览

【归档层】history/（历史记录）
  - 已完成迭代的归档
  - 输入日志归档
  - 按需查阅
```

**跨 Session 状态连续**：
- Claude Code 每次启动是全新上下文
- AI 必须在对话开始时主动读取 `.flow/state.json`
- 读取后汇报当前状态，再继续工作

### 4.6 Pending Docs 机制

**目的**：追踪"实现先行"场景下的文档债务

**触发场景**：
- 实现倒逼设计：实现时发现设计遗漏，先改代码再补文档
- 快速热修复：紧急修复先上线，后补文档

**AI操作**：
- 发现文档债务时，读取 `.flow/pending-docs.md`，按现有格式追加到"待同步"
- Commit 前检查并提醒人类处理
- 处理完成后移到"已同步"

### 4.7 输出规范（Output Standards）

**目的**：AI 输出对人类认知友好

```
强制总分结构：

【任何输出都必须】
  1. 先给结论/全局（1-3句话）
  2. 再给要点（列表，不超过7项）
  3. 最后给细节（可折叠/按需展开）

【设计文档】
  - 先架构图/流程图
  - 再模块说明
  - 最后实现细节

【代码输出】
  - 先说改什么、为什么
  - 再给代码
  - 最后说验证方法
```

---

## 五、阶段详细规则

### 5.1 项目启动

| 项目 | 内容 |
|------|------|
| **触发** | 新项目开始 |
| **AI做什么** | 引导人类描述愿景 → 整理成产品PRD → 确认迭代1范围 |
| **产出** | `docs/产品PRD.md` |
| **审批** | 人类确认产品PRD |
| **完成标志** | 产品PRD已审批，迭代1范围已确定 |

**产品PRD内容**：
- 产品愿景（一句话 + 核心价值）
- 产品描述（High Level，非功能清单）
- 路线图（阶段划分）
- 迭代1引用（指向迭代1-PRD）

### 5.2 迭代-需求

| 项目 | 内容 |
|------|------|
| **触发** | 进入新迭代 |
| **AI做什么** | 引导人类明确范围 → 整理功能清单 → 定义验收标准 |
| **产出** | `docs/iterations/迭代X-PRD.md` |
| **审批** | 人类确认迭代PRD |
| **完成标志** | 迭代PRD已审批 |

**迭代PRD内容**：
- 迭代目标（一句话）
- 功能范围（模块/功能清单）
- 验收标准（怎么算完成）
- 依赖说明（依赖哪些已有模块）

### 5.3 迭代-设计

| 项目 | 内容 |
|------|------|
| **触发** | 迭代PRD已审批 |
| **AI做什么** | 技术方案设计 → 模块设计 → 接口定义 |
| **产出** | `docs/iterations/迭代X-设计.md` |
| **审批** | 人类确认设计 |
| **完成标志** | 设计文档已审批 |

**变更触发影响分析**：
- 如果设计时发现PRD问题 → 先输出影响分析 → 人类确认 → 回到需求阶段

### 5.4 迭代-实现

| 项目 | 内容 |
|------|------|
| **触发** | 设计已审批 |
| **AI做什么** | 按设计实现代码 → 编写测试 → 执行测试 |
| **产出** | 代码 + 测试 |
| **验证** | 测试通过（自动） |
| **完成标志** | 所有测试通过 |

**变更触发影响分析**：
- 实现时发现设计问题 → 影响分析 → 人类确认 → 回到设计阶段

### 5.5 迭代-验证

| 项目 | 内容 |
|------|------|
| **触发** | 实现完成，测试通过 |
| **AI做什么** | 整理验收清单 → 协助人类验收 → 记录发布 |
| **产出** | 验收记录 + 版本Tag |
| **验收** | 人类确认验收 |
| **完成标志** | 迭代完成，可开始下一迭代 |

---

## 六、文件结构

```
项目根目录/
├── CLAUDE.md                    # 本规范
├── docs/
│   ├── 产品PRD.md               # 产品愿景+路线图+元原则
│   ├── 流程文档.md              # 业务流程+模块协作（迭代1由CLAUDE.md暂代）
│   └── iterations/
│       ├── 迭代1-PRD.md         # 迭代1需求
│       └── ...
├── src/                         # 源代码
├── tests/                       # 测试
└── .flow/                       # 流程状态（AI管理）
    ├── state.json               # 唯一状态数据源
    ├── input-log.md             # 输入日志
    ├── spark-box.md             # 灵光收集箱
    └── pending-docs.md          # 待同步文档记录
    # history/                   # 历史归档（迭代2+）
```

---

## 七、AI 行为准则

### 始终做

- 维护流程上下文（知道当前阶段和任务）
- 捕获关键输入到输入日志
- 灵光一闪记录到收集箱，不打断当前任务
- 变更前先做影响分析
- 输出用总分结构（先结论后细节）

### 绝不做

- 不在需求阶段写代码
- 不跳过影响分析直接执行变更
- 不一次输出超过人类认知负荷的内容
- 不丢失人类的关键输入

### 主动引导

```
当人类输入与当前阶段不符时：

不要：直接执行人类字面要求
要：先说明当前阶段，询问是否切换

示例：
  人类："我想改一下登录的逻辑"

  错误：直接开始改代码

  正确："当前在【迭代1-需求】阶段。
        你说的是修改登录逻辑，这涉及需求变更。
        按流程应该：1.更新PRD → 2.影响分析 → 3.更新设计 → 4.改代码
        要现在开始吗？还是先记录到灵光收集箱？"
```

---

## 八、快速开始

### 新项目

```
1. 人类描述产品想法
2. AI 引导完成产品PRD
3. 人类审批PRD
4. 进入迭代1-需求
```

### 继续工作

```
1. AI 读取 .flow/state.json 恢复状态
2. AI 汇报：当前阶段、进度、待处理灵光
3. 人类决定继续当前任务 or 处理其他
4. 开始工作
```

---

**这是核心流程规范 v0.5，在实践中持续演进。**

*v0.5 更新：移除内联模板，改为"按需读取"（AI操作时读取实际文件获取格式）*
*v0.4 更新：添加文件格式模板（input-log.md、spark-box.md、pending-docs.md），确保AI操作格式一致*
*v0.3 更新：移除迭代2+功能（任务栈、变更传播），确保规范仅包含迭代1可执行内容*
*v0.2 更新：状态管理改为唯一数据源 state.json、规划→需求*
